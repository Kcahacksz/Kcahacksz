// this script lets you solve the match AND APPEAR ON THE LEADERBOARD
// in a time that YOU get to select (it could even be 2 seconds)

(() => {
    const encodeData = (data) => {
        let str = JSON.stringify(data);
        let encodedParts = [];

        for (let i = 0; i < str.length; i++) {
            let modifiedCharCode = str.charCodeAt(i) + (77 % (i + 1));
            encodedParts.push(modifiedCharCode);
        }

        return encodedParts.join("-");
    }

    let num = Number(prompt('what do you want your match time to be? enter in the format "5.1":').replaceAll('.', ''));

    let data = encodeData({
        previous_record: 0,
        score: num,
        selectedOnly: false,
        time_started: Date.now() - (num * 100) - 1500,
        too_small: 0
    });

    let token = document.cookie.split('qtkn=')[1].split(';')[0];
    let setId = __NEXT_DATA__.query.setId;

    fetch(`https://quizlet.com/${setId}/scatter/highscores`, {
        headers: {
            'content-type': 'application/json',
            'cs-token': token,
            'x-quizlet-api-security-id': token,
            'x-requested-with': 'XMLHttpRequest'
        },
        body: JSON.stringify({ data }),
        method: 'POST'
    });
})();








// works 90% of the time, use solveInTime for a 100% working version
// if it doesn't show the correct matches, reload the tab and paste in the script again

(() => {
    const hack = () => {
        if (document.querySelectorAll('.FormattedText').length != 12) return setTimeout(hack, 50);

        let setData = JSON.parse(__NEXT_DATA__.props.pageProps.dehydratedReduxStateKey);
        let cards = setData.studyModesCommon.studiableData.studiableItems;

        let blacklist = [];

        let find = (ig) => [...document.querySelectorAll('.FormattedText')].find((i) => ig.startsWith(i.innerText.replace('…', '')));

        const colors = [
            '#FF007F',
            '#FFAA1D',
            '#FFF000',
            '#66FF00',
            '#08E8DE',
            '#1974D2'
        ];

        let colorIndex = 0;

        for (let i = 0; i < 12; i++) {
            let text = document.querySelectorAll('.FormattedText')[i].innerText;
            if (blacklist.includes(text)) continue;

            let needStartsWith = text.endsWith('…');

            let card = cards.find((card) => card.cardSides.some((side) => {
                if (needStartsWith) return side.media[0].plainText.startsWith(text.replace('…', ''))
                else return side.media[0].plainText == text
            }));

            let termSide = card.cardSides.find((side) => side.label == 'word');
            let definSide = card.cardSides.find((side) => side.label == 'definition');

            let term = termSide.media[0].plainText;
            let defin = definSide.media[0].plainText;

            let isTerm = term == text;
            let isDef = defin == text;

            find(term).style.border = `2px solid ${colors[colorIndex]}`;
            find(defin).style.border = `2px solid ${colors[colorIndex]}`;

            find(term).style.borderRadius = '15px';
            find(defin).style.borderRadius = '15px';

            colorIndex++;

            if (isTerm) blacklist.push(defin);
            else if (isDef) blacklist.push(term);
        }
    }

    hack();
})();

